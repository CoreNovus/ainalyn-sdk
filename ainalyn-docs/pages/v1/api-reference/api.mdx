# API Reference

The main API functions for validating and exporting agents.

## validate()

Validates an agent definition.

```python
from ainalyn.api import validate

result = validate(agent)
```

**Parameters:**
- `definition` (AgentDefinition) - The agent to validate

**Returns:**
- `ValidationResult` - Contains validation errors and warnings
  - `result.is_valid` (bool) - True if no errors found
  - `result.has_warnings` (bool) - True if warnings found
  - `result.errors` (tuple[ValidationError, ...]) - All errors and warnings

**Validation Steps:**
1. Schema validation (structural correctness)
2. Static analysis (logical consistency, circular dependencies, unreachable nodes)

**Example:**
```python
from ainalyn import AgentBuilder, WorkflowBuilder, NodeBuilder, PromptBuilder
from ainalyn.api import validate

prompt = PromptBuilder("my-prompt").description("Test prompt").template("Hello").build()
workflow = (
    WorkflowBuilder("my-workflow")
    .description("Test workflow")
    .add_node(NodeBuilder("node1").description("Node 1").uses_prompt("my-prompt").build())
    .entry_node("node1")
    .build()
)
agent = (
    AgentBuilder("my-agent")
    .version("1.0.0")
    .description("Test agent")
    .add_prompt(prompt)
    .add_workflow(workflow)
    .build()
)

result = validate(agent)
if result.is_valid:
    print("Valid!")
else:
    for error in result.errors:
        print(f"{error.severity.value}: {error.code} - {error.message}")
```

## export_yaml()

Exports an agent definition to YAML.

```python
from ainalyn.api import export_yaml

yaml_output = export_yaml(agent)
```

**Parameters:**
- `definition` (AgentDefinition) - The agent to export

**Returns:**
- `str` - YAML-formatted string with header comments

**Important:**
- This function does NOT validate before exporting
- For a complete workflow with validation, use `compile_agent()` instead

**Example:**
```python
from ainalyn import AgentBuilder, WorkflowBuilder, NodeBuilder, PromptBuilder
from ainalyn.api import export_yaml

prompt = PromptBuilder("my-prompt").description("Test").template("Hello").build()
workflow = (
    WorkflowBuilder("my-workflow")
    .description("Test")
    .add_node(NodeBuilder("node1").description("Node").uses_prompt("my-prompt").build())
    .entry_node("node1")
    .build()
)
agent = (
    AgentBuilder("my-agent")
    .version("1.0.0")
    .description("Test agent")
    .add_prompt(prompt)
    .add_workflow(workflow)
    .build()
)

yaml_str = export_yaml(agent)
print(yaml_str)
```

## compile_agent()

Validates and exports an agent definition (recommended workflow).

```python
from ainalyn.api import compile_agent
from pathlib import Path

result = compile_agent(agent, Path("agent.yaml"))
```

**Parameters:**
- `definition` (AgentDefinition) - The agent to compile
- `output_path` (Path | None) - Optional file path to save YAML. If None, returns YAML without writing.

**Returns:**
- `CompilationResult` - Contains:
  - `validation_result` (ValidationResult) - Validation results
  - `yaml_content` (str | None) - YAML string if successful
  - `output_path` (Path | None) - File path if written
  - `is_successful` (bool) - True if validation passed

**Workflow:**
1. Validates the definition (schema + static analysis)
2. Exports to YAML (only if validation passes)
3. Writes to file (if output_path provided)

**Important:** Local compilation does NOT equal platform execution. This creates a description for platform submission.

**Example:**
```python
from ainalyn import AgentBuilder, WorkflowBuilder, NodeBuilder, PromptBuilder
from ainalyn.api import compile_agent
from pathlib import Path

# Build agent
prompt = PromptBuilder("my-prompt").description("Test").template("Hello").build()
workflow = (
    WorkflowBuilder("my-workflow")
    .description("Test")
    .add_node(NodeBuilder("node1").description("Node").uses_prompt("my-prompt").build())
    .entry_node("node1")
    .build()
)
agent = (
    AgentBuilder("my-agent")
    .version("1.0.0")
    .description("Test agent")
    .add_prompt(prompt)
    .add_workflow(workflow)
    .build()
)

# Compile to file
result = compile_agent(agent, Path("output.yaml"))

if result.is_successful:
    print(f"Compiled to {result.output_path}")
else:
    print("Validation failed:")
    for error in result.validation_result.errors:
        print(f"  {error.code}: {error.message}")
```
